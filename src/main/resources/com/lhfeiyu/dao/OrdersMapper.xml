<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lhfeiyu.dao.OrdersMapper">
	<resultMap type="com.lhfeiyu.po.Orders" id="OrdersMap">
		<id property="ordersid" column="ordersid" />
		<result property="inserttime" column="inserttime" />
		<result property="createtime" column="createtime" />
		<result property="createuserid" column="createuserid" />
		<result property="inuserid" column="inuserid" />
	</resultMap>

	<resultMap type="com.lhfeiyu.po.Orders" id="OrdersLinkDitelMap"
		extends="OrdersMap">
		<collection property="ordersdetails" ofType="com.lhfeiyu.po.Ordersparticular">
			<id property="ordersparticularid" column="ordersparticularid" />
			<result property="ordersno" column="ordersno" />
			<result property="productname" column="productname" />
			<result property="productid" column="productid" />
			<result property="size" column="size" />
			<result property="num" column="num" />
			<result property="mununit" column="mununit" />

			<result property="createproduct" column="createproduct" />
			<result property="producttypeid" column="producttypeid" />
			<result property="supplierid" column="supplierid" />
			<result property="ordersid" column="ordersid" />
		</collection>
		<!-- 创建人 -->
		<collection property="cuser" column="createuserid" ofType="com.lhfeiyu.po.User">
			<id column="id" property="id" />
			<result property="username" column="username" />
		</collection>

		<collection property="inuser" column="inuserid" ofType="com.lhfeiyu.po.User">
			<id column="id" property="id" />
			<result property="username" column="username" />
		</collection>
	</resultMap>

	<sql id="suffix">
		<trim>
			<if test="orderBy!=null and orderBy!='' "> order by o.ordersId #{orderBy}</if>
			<if test="orderBy==null and orderBy=='' "> order by o.ordersId DESC </if>
		</trim>
	</sql>

	<sql id="limitCount"><!-- 分页 -->
		<if test="count != null and count !='' "> LIMIT ${start},${count}</if>
	</sql>

	<select id="findOrders" parameterType="java.util.Map" resultMap="OrdersLinkDitelMap">
		SELECT o.*,oe.*,cuser.id,cuser.username ,inuser.id,inuser.username
		FROM orders o,ordersparticular oe,`user` AS cuser,`user` AS inuser
		WHERE 1 = 1
		AND oe.orders_id = o.ordersid
		AND cuser.id = o.createuserid
		AND inuser.id = o.inuserid
		<include refid="suffix" />
		<include refid="limitCount" />
	</select>

	<sql id="columAddvalueSuffix">
		<trim suffixOverrides="," >
			<if test="createuserid!=null">#{createuserid},</if>
			<if test="createuserid==null">null,</if>
			<if test="createtime==null">SYSDATE(),</if>
			<if test="inuserid==null">null</if>
		</trim>

	</sql>

	<!-- 添加订单 -->
	<insert id="addOrder" parameterType="java.util.Map">
		insert into orders
		(createuserid,createtime,inuserid,inserttime)
		VALUES(
		1,SYSDATE(),3,SYSDATE()
		);
	</insert>

</mapper>